<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
<meta name="description" content="PhotoPro - T√¨m v√† mua ·∫£nh du l·ªãch c·ªßa b·∫°n b·∫±ng AI">
<meta name="theme-color" content="#1a6b4e">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<title>PhotoPro ‚Äî T√¨m ·∫¢nh Du L·ªãch C·ªßa B·∫°n</title>

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

<!-- Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<script src="https://unpkg.com/lucide@latest"></script>

<!-- Stylesheets -->
<link rel="stylesheet" href="./css/global.css">
<link rel="stylesheet" href="./css/navigation.css">
<link rel="stylesheet" href="./css/components.css">
<link rel="stylesheet" href="./css/photos.css">
</head>
<body>

<!-- ============================================
     TOP BAR ‚Äî Demo Navigation
     ============================================ -->
<div class="demo-topbar">
  <div class="demo-topbar-left">
    <span class="demo-label">DEMO</span>
    <span class="mobile-hidden">PhotoPro ‚Äî Demo Ho√†n Ch·ªânh</span>
  </div>
  <div>
    <span id="current-time"></span>
  </div>
</div>

<!-- ============================================
     TABS ‚Äî Switch between pages
     ============================================ -->
<div class="demo-tabs">
  <div class="demo-tab active" data-page="landing"><i data-lucide="home"></i> Trang ch·ªß</div>
  <div class="demo-tab" data-page="albums"><i data-lucide="folder"></i> Album</div>
  <div class="demo-tab" data-page="face-search"><i data-lucide="scan-face"></i> Qu√©t</div>
  <div class="demo-tab" data-page="results"><i data-lucide="images"></i> K·∫øt qu·∫£</div>
  <div class="demo-tab" data-page="cart"><i data-lucide="shopping-cart"></i> Gi·ªè</div>
  <div class="demo-tab" data-page="checkout"><i data-lucide="credit-card"></i> Thanh to√°n</div>
  <div class="demo-tab" data-page="success"><i data-lucide="check-circle"></i> Th√†nh c√¥ng</div>
  <div class="demo-tab" data-page="delivery"><i data-lucide="download"></i> T·∫£i</div>
  <div class="demo-tab" data-page="lookup"><i data-lucide="search"></i> Tra c·ª©u</div>
</div>

<!-- ============================================
     PAGES Container
     ============================================ -->
<div id="pages-container"></div>

<!-- ============================================
     LOADING OVERLAY
     ============================================ -->
<div class="loading-overlay hidden" id="loading-overlay">
  <div class="loading-content">
    <div class="loading-spinner"></div>
    <div class="loading-text" id="loading-text">ƒêang x·ª≠ l√Ω...</div>
    <div class="loading-subtext" id="loading-subtext">Vui l√≤ng ƒë·ª£i</div>
  </div>
</div>

<!-- ============================================
     MODAL - Photo Preview
     ============================================ -->
<div class="modal-overlay" id="photo-modal">
  <div class="modal">
    <div class="modal-header">
      <h3>Xem ·∫¢nh</h3>
      <button class="modal-close" onclick="uiManager.closeModal('photo-modal')">√ó</button>
    </div>
    <div class="modal-body text-center">
      <div style="aspect-ratio: 3/4; background: var(--surface-alt); border-radius: var(--radius); display: flex; align-items: center; justify-content: center; font-size: 4rem; color: var(--text-muted);">
        üì∑
      </div>
      <div class="mt-3">
        <div class="badge badge-primary">98% kh·ªõp</div>
        <div class="badge badge-muted">#couple</div>
        <div class="badge badge-muted">#sunset</div>
      </div>
      <button class="btn btn-primary btn-block mt-3" onclick="uiManager.closeModal('photo-modal')">
        ƒê√≥ng
      </button>
    </div>
  </div>
</div>

<!-- ============================================
     JAVASCRIPT ‚Äî Core Libraries
     ============================================ -->
<script src="./js/dataManager.js"></script>
<script src="./js/stateManager.js"></script>
<script src="./js/uiManager.js"></script>
<script src="./js/navigationManager.js"></script>
<script src="./js/appManager.js"></script>

<!-- ============================================
     JAVASCRIPT ‚Äî Pages
     ============================================ -->
<script src="./js/pages/landing.js"></script>
<script src="./js/pages/albums.js"></script>
<script src="./js/pages/faceSearch.js"></script>
<script src="./js/pages/results.js"></script>
<script src="./js/pages/cart.js"></script>
<script src="./js/pages/checkout.js"></script>
<script src="./js/pages/success.js"></script>
<script src="./js/pages/delivery.js"></script>
<script src="./js/pages/lookup.js"></script>

<!-- ============================================
     JAVASCRIPT ‚Äî Main App Initialization
     ============================================ -->
<script>
/**
 * Main App Initialization
 */
async function initializeApp() {
  console.log('üöÄ Initializing PhotoPro...');

  try {
    // 1. Load data
    await dataManager.loadData();
    console.log('‚úÖ Data loaded');

    // 2. Initialize managers
    uiManager = new UIManager(dataManager, stateManager);
    navigationManager = new NavigationManager(stateManager);
    appManager = new AppManager(dataManager, stateManager, uiManager);
    
    console.log('‚úÖ Managers initialized:', {
      dataManager: !!dataManager,
      stateManager: !!stateManager,
      uiManager: !!uiManager,
      navigationManager: !!navigationManager,
      appManager: !!appManager
    });
    
    // Make appManager globally accessible
    window.appManager = appManager;
    window.stateManager = stateManager;
    window.dataManager = dataManager;
    console.log('‚úÖ Managers exposed to window object');

    // 3. Load all pages
    await loadAllPages();
    console.log('‚úÖ Pages loaded');

    // 4. Initialize navigation
    navigationManager.init();

    // 5. Initialize app
    appManager.init();

    // 6. Render initial content
    renderInitialContent();
    console.log('‚úÖ Initial content rendered');

    // 7. Subscribe to state changes
    stateManager.subscribe(() => {
      uiManager.updateCartInfo();
    });

    console.log('üéâ PhotoPro initialized successfully!');
  } catch (error) {
    console.error('‚ùå Error initializing app:', error);
  }
}

/**
 * Load all page HTML files
 */
async function loadAllPages() {
  const container = document.getElementById('pages-container');
  if (!container) return;

  const pages = [
    'landing',
    'albums', 
    'faceSearch',
    'results',
    'cart',
    'checkout',
    'success',
    'delivery',
    'lookup'
  ];

  for (const page of pages) {
    try {
      const response = await fetch(`./pages/${page}.html`);
      const html = await response.text();
      container.innerHTML += html;
    } catch (error) {
      console.error(`Error loading page ${page}:`, error);
    }
  }
}

/**
 * Render initial content
 */
function renderInitialContent() {
  // Render landing page albums
  uiManager.renderAlbums('landing-albums', 3);
  
  // Render albums list page
  uiManager.renderAlbums('albums-list');
  
  // Render results photos
  uiManager.renderPhotos('bana-grid', dataManager.getPhotosByCategory('bana'));
  uiManager.renderPhotos('hoian-grid', dataManager.getPhotosByCategory('hoian'));
  uiManager.renderPhotos('dragon-grid', dataManager.getPhotosByCategory('dragon'));
  
  // Render pricing
  uiManager.renderPricingCards('pricing-cards');
  
  // Update cart info
  uiManager.updateCartInfo();
  
  // Update delivery page
  uiManager.updateDeliveryPage();
}

// Start the app when DOM is ready
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initializeApp);
} else {
  initializeApp();
}
</script>

<!-- ============================================
     LIGHTBOX ‚Äî Photo zoom viewer
     ============================================ -->
<div id="lightbox" class="lightbox">
  <div class="lightbox-content">
    <button class="lightbox-close" onclick="appManager.closeLightbox()">√ó</button>
    <img id="lightbox-image" class="lightbox-image" src="" alt="Photo">
    <div class="lightbox-info">
      <span id="lightbox-counter"></span>
      <label class="lightbox-checkbox">
        <input type="checkbox" id="lightbox-checkbox" onchange="appManager.toggleLightboxPhoto()">
        <span>Ch·ªçn ·∫£nh n√†y</span>
      </label>
    </div>
  </div>
</div>

<!-- ============================================
     QR PAYMENT MODAL
     ============================================ -->
<div id="qrModal" class="modal" style="display: none;">
  <div class="modal-content" style="max-width: 400px;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
      <h3 id="qrModalTitle" style="margin: 0;">Thanh to√°n MoMo</h3>
      <button class="lightbox-close" onclick="appManager.closeQRModal()" style="position: static; margin: 0;">√ó</button>
    </div>
    
    <div style="text-align: center;">
      <div id="qrCode" class="qr-code" style="margin: 20px auto;">
        <div style="font-size: 80px;"><i data-lucide="smartphone" style="width: 80px; height: 80px; stroke-width: 1.5;"></i></div>
      </div>
      
      <div id="qrInfo" style="background: var(--surface-elevated); padding: 16px; border-radius: 8px; margin-top: 16px;">
        <p style="margin: 0 0 8px 0; font-size: 14px; color: var(--text-secondary);">S·ªë ti·ªÅn thanh to√°n:</p>
        <p id="qrAmount" style="margin: 0; font-size: 24px; font-weight: bold; color: var(--primary);">0‚Ç´</p>
        <p style="margin: 12px 0 0 0; font-size: 14px; color: var(--text-secondary);">N·ªôi dung: <strong id="qrContent">WL1234</strong></p>
      </div>
      
      <div id="qrStatus" style="margin-top: 20px; padding: 16px; background: var(--info-light, #eff6ff); border-radius: 8px; border: 2px dashed var(--info, #2563eb);">
        <div style="display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 8px;">
          <div class="spinner" style="width: 20px; height: 20px; border: 3px solid var(--info); border-top-color: transparent; border-radius: 50%; animation: spin 1s linear infinite;"></div>
          <span style="font-weight: 600; color: var(--info);">ƒêang ch·ªù thanh to√°n...</span>
        </div>
        <p style="margin: 0; font-size: 14px; color: var(--text-secondary);">
          T·ª± ƒë·ªông x√°c nh·∫≠n sau khi thanh to√°n th√†nh c√¥ng
        </p>
        <p id="qrTimer" style="margin: 8px 0 0 0; font-size: 18px; font-weight: bold; color: var(--info);">05:00</p>
      </div>
      
      <p style="margin-top: 16px; font-size: 14px; color: var(--text-secondary);">
        Qu√©t m√£ QR b·∫±ng ·ª©ng d·ª•ng ƒë·ªÉ thanh to√°n
      </p>
    </div>
  </div>
</div>

<!-- Initialize Lucide Icons -->
<script>
  lucide.createIcons();
</script>

</body>
</html>
